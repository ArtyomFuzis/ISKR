networks:
    {{network_name}}:
      external: true
      name: {{network_name}}

services:
  integration1:
    container_name: {{container_name}}
    build:
      context: .
      dockerfile: ./build/Dockerfile-Integration
    restart: unless-stopped
    networks:
      - {{network_name}}
    environment:
      SERVICE_NAME: {{service_name}}
      PG_USERNAME: ${PG_USER}
      PG_PASSWORD: ${PG_PASSWORD}
      PORT: {{service_port}}
      CONSUL_HOST: {{consul_host}}
      CONSUL_PORT: {{consul_port}}
      DISCOVERY_HOSTNAME: {{discovery_hostname}}
      CONSUL_KV_DEFAULT: {{consul_default}}
      SSO_USERNAME: ${SSO_USERNAME}
      SSO_PASSWORD: ${SSO_PASSWORD}
      SSO_REALM: ${SSO_REALM}
      SSO_SECRET: ${SSO_SECRET}
    ports:
      - "{{service_port}}:{{service_port}}"
    extra_hosts:
      - "host.docker.internal:host-gateway"

  integration2:
    container_name: integration2
    build:
      context: .
      dockerfile: ./build/Dockerfile-Integration
    restart: unless-stopped
    networks:
      - {{network_name}}
    environment:
      SERVICE_NAME: {{service_name}}
      PG_USERNAME: ${PG_USER}
      PG_PASSWORD: ${PG_PASSWORD}
      PORT: 8026
      CONSUL_HOST: {{consul_host}}
      CONSUL_PORT: {{consul_port}}
      DISCOVERY_HOSTNAME: integration2
      CONSUL_KV_DEFAULT: {{consul_default}}
      SSO_USERNAME: ${SSO_USERNAME}
      SSO_PASSWORD: ${SSO_PASSWORD}
      SSO_REALM: ${SSO_REALM}
      SSO_SECRET: ${SSO_SECRET}
    ports:
      - "8026:8026"
    extra_hosts:
      - "host.docker.internal:host-gateway"